#!/bin/bash

echo "üîç Jenkins Webhook Configuration Helper"
echo "======================================"
echo ""

echo "üìã STEP 1: Check Your Jenkins Job Configuration"
echo "----------------------------------------------"
echo "1. Go to: https://jenkins.ingasti.com/job/bedtimeblog-k8s/configure"
echo "   (or whatever your job name is)"
echo ""
echo "2. Look for these sections and check the settings:"
echo ""
echo "   üìÇ Source Code Management:"
echo "   ‚Ä¢ Repository URL should be: https://github.com/jcgarcia/bedtimeblog.git"
echo "   ‚Ä¢ Credentials: Look for a dropdown to select webhook credentials"
echo "   ‚Ä¢ Branch Specifier: Should be */k8s or */*"
echo ""
echo "   ‚ö° Build Triggers:"
echo "   ‚Ä¢ ‚úÖ GitHub hook trigger for GITScm polling (should be checked)"
echo "   ‚Ä¢ Look for any secret/credential options in this section"
echo ""

echo "üìã STEP 2: Check Jenkins Global GitHub Configuration"
echo "--------------------------------------------------"
echo "1. Go to: https://jenkins.ingasti.com/manage/configure"
echo "2. Scroll down to find 'GitHub' section"
echo "3. Look for:"
echo "   ‚Ä¢ GitHub Servers configuration"
echo "   ‚Ä¢ Webhook secret settings"
echo "   ‚Ä¢ Add your webhook secret credential if needed"
echo ""

echo "üìã STEP 3: Check Jenkins Security Configuration"
echo "---------------------------------------------"
echo "1. Go to: https://jenkins.ingasti.com/manage/configureSecurity/"
echo "2. Look for:"
echo "   ‚Ä¢ CSRF Protection: Should have 'Enable proxy compatibility' ‚úÖ"
echo "   ‚Ä¢ Any webhook-related security settings"
echo ""

echo "üìã STEP 4: Verify Installed Plugins"
echo "----------------------------------"
echo "1. Go to: https://jenkins.ingasti.com/manage/pluginManager/installed"
echo "2. Search for these plugins (they should be installed):"
echo "   ‚Ä¢ GitHub plugin"
echo "   ‚Ä¢ GitHub Branch Source plugin"
echo "   ‚Ä¢ Git plugin"
echo "   ‚Ä¢ Webhooks plugin"
echo ""

echo "üîß MOST LIKELY FIX:"
echo "=================="
echo ""
echo "The issue is probably that your Jenkins job needs to be configured"
echo "to use the webhook secret credential. Here's what to do:"
echo ""
echo "1. Jenkins Job ‚Üí Configure ‚Üí Source Code Management"
echo "2. Look for 'Additional Behaviours' or 'Advanced' button"
echo "3. Add 'GitHub Webhook Verification' behavior if available"
echo "4. Select your webhook secret credential"
echo ""
echo "OR:"
echo ""
echo "1. Manage Jenkins ‚Üí Configure System ‚Üí GitHub section"
echo "2. Add GitHub Server if not configured"
echo "3. Set API URL: https://api.github.com"
echo "4. Set webhook secret to your credential"
echo "5. Test connection"
echo ""

echo "üß™ Quick Test After Configuration:"
echo "================================="
echo "After making changes, test by pushing a commit to your k8s branch:"
echo ""
echo "git add ."
echo "git commit -m 'Test webhook trigger'"
echo "git push origin k8s"
echo ""
echo "Then check:"
echo "‚Ä¢ GitHub webhook delivery logs"
echo "‚Ä¢ Jenkins job build history"
echo "‚Ä¢ Jenkins system logs if build doesn't trigger"
